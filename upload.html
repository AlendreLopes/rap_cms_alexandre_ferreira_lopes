<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
    <input type="file" name="file" multiple>

    <ul class="list-group rounded-0" id="file-list"></ul>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script>

        var filesToUpload = []; // Array to store files
        $('input[name="file"]').on('change', function (e) {
            for (let i = 0; i < e.target.files.length; i++) {
                let myFile = e.target.files[i];
                let myFileID = "FID" + (1000 + Math.random() * 9000).toFixed(0);

                filesToUpload.push({
                    file: myFile,
                    size: myFile.size,
                    FID: myFileID,
                    name: myFile.name
                });
            }
            display();
            // Reset the input to null - nice little Chrome bug!
            e.target.value = null;
        });

        $(document).on('click', '.remove-button', function () {
            var fidToRemove = $(this).data('fid');
            for (let i = 0; i < filesToUpload.length; i++) {
                if (filesToUpload[i].FID === fidToRemove) {
                    filesToUpload.splice(i, 1);
                    break;
                }
            }
            display();
        });
        // HTML element to display the file list
        const display = () => {
            $('#file-list').empty();
            for (let i = 0; i < filesToUpload.length; i++) {
                $("#file-list").append(`
                <li class="list-group-item d-flex  justify-content-between align-items-center my-2 border">
                    <div>${filesToUpload[i].name}- ${bytesToMB(filesToUpload[i].size)}-MB</div>
                    <div>
                        <a class="remove-button" data-fid="${filesToUpload[i].FID}">
                            <i class="fa fa-close"></i>Remove
                        </a>
                    </div>
                    <div class="image-parent">
                        <img src="${URL.createObjectURL(filesToUpload[i].file)}" class="img-fluid" alt="quixote">
                    </div>
                </li>`);
            }
            $("#upload-vehicle-variant-image-modal .fileuploadCount").val(`Total file upload: ` + filesToUpload.length)
        };


        $("#upload-vehicle-variant-image-modal").on('click', '.UploadImageBtn', function () {
            let formData = new FormData();

            for (let i = 0; i < filesToUpload.length; i++) {
                formData.append("files", filesToUpload[i].file);
            }

            console.log('formData:::::', formData)

            $.ajax({
                type: "POST",
                url: "/admin/fleet/vehicle-variant-upload-image",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log('RESPONSE', data)
                    if (data.statusCode == "200") {
                        createToast({
                            title: "ALERT",
                            msg: data.message,
                            type: "positive"
                        });
                        setTimeout(function () {
                            location.reload()
                        }, 500)
                    } else {
                        createToast({
                            title: "ALERT",
                            msg: data.message,
                            type: "negative"
                        });
                    }
                },
                error: function (error) {
                    console.log('ERORR:::::::', error)
                },
                dataType: 'JSON'
            });

        })



        function bytesToMB(bytes) {
            return (bytes / (1024 * 1024)).toFixed(2);
        }
    </script>
        <script>
            var filesToUpload = []; // Array to store files
            $('input[name="images"]').on('change', function (e) {
                for (let i = 0; i < e.target.files.length; i++) {
                    let myFile = e.target.files[i];
                    let myFileID = "FID" + (1000 + Math.random() * 9000).toFixed(0);

                    filesToUpload.push({
                        file: myFile,
                        size: myFile.size,
                        FID: myFileID,
                        name: myFile.name
                    });
                }
                display();
                // Reset the input to null - nice little Chrome bug!
                e.target.value = null;
            });

            $(document).on('click', '.remove-button', function () {
                var fidToRemove = $(this).data('fid');
                for (let i = 0; i < filesToUpload.length; i++) {
                    if (filesToUpload[i].FID === fidToRemove) {
                        filesToUpload.splice(i, 1);
                        break;
                    }
                }
                display();
            });
            // HTML element to display the file list
            const display = () => {
                $('#file-list').empty();
                for (let i = 0; i < filesToUpload.length; i++) {
                    $("#file-list").append(
                        `<li class="list-group-item d-flex justify-content-between align-items-center my-2 border">

                        <div>
                            <a class="remove-button" data-fid="${filesToUpload[i].FID}"><i class="fa fa-close"></i></a>
                        </div>

                        <div>
                            ${filesToUpload[i].name}- ${bytesToMB(filesToUpload[i].size)}-MB
                        </div>
                        
                        <div class="image-parent">
                            <img src="${URL.createObjectURL(filesToUpload[i].file)}" class="img-fluid" alt="quixote">
                        </div>
                    </li>`);
                }

                $("#upload-vehicle-variant-image-modal .fileuploadCount").val(`Total file upload: ` + filesToUpload.length)
            };


            $("#upload-vehicle-variant-image-modal").on('click', '.UploadImageBtn', function () {
                let formData = new FormData();

                for (let i = 0; i < filesToUpload.length; i++) {
                    formData.append("files", filesToUpload[i].file);
                }

                console.log('formData:::::', formData)

                $.ajax({
                    type: "POST",
                    url: "/administrators/products/images/store",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        console.log('RESPONSE', data)
                        if (data.statusCode == "200") {
                            createToast({
                                title: "ALERT",
                                msg: data.message,
                                type: "positive"
                            });
                            setTimeout(function () {
                                location.reload()
                            }, 500)
                        } else {
                            createToast({
                                title: "ALERT",
                                msg: data.message,
                                type: "negative"
                            });
                        }
                    },
                    error: function (error) {
                        console.log('ERORR:::::::', error)
                    },
                    dataType: 'JSON'
                });

            })

            function bytesToMB(bytes) {
                return (bytes / (1024 * 1024)).toFixed(2);
            }
        </script>
</body>

</html>